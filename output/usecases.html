<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>HL7.FHIR.US.FHIR-DIRECTORY-ATTESTATION\Usecases - FHIR v4.0.1</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link rel="stylesheet" href="fhir.css"/>

      <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap-fhir.css"/>

      <!-- Project extras -->
    <link rel="stylesheet" href="assets/css/project.css"/>
    <link rel="stylesheet" href="assets/css/pygments-manni.css"/>
    <link rel="stylesheet" href="assets/css/jquery-ui.css"/>
  	<link rel="stylesheet" href="assets/css/prism.css"/>
      <!-- Placeholder for child template CSS declarations -->
    <link rel="stylesheet" href="assets/css/hl7.css"/>
    <link rel="stylesheet" href="assets/css/fhir-ig.css"/>

    <script src="fhir-table-scripts.js" type="text/javascript"> </script>

      <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!-- [if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif] -->

      <!-- Favicons -->
    <link sizes="144x144" rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link sizes="114x114" rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link sizes="72x72" rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"94"}
    h3,h4,h5,h6{--heading-prefix:"94"}</style>
    <div id="segment-header" class="segment">    <!-- segment-header -->
      <div class="container">    <!-- container -->
          <!-- Placeholder for child template header declarations -->

        <div id="hl7-nav">
          <a no-external="true" id="hl7-logo" href="http://hl7.org">
            <img src="assets/images/hl7-logo-header.png" alt="Visit the HL7 website" height="50"/>
          </a>
        </div>
        <div id="family-nav">
          <a no-external="true" id="family-logo" href="http://hl7.org/fhir"><img src="assets/images/fhir-logo-www.png" alt="Visit the FHIR website" height="50"/> </a>
        </div>
        <div id="hl7-search">
          <a no-external="true" id="hl7-search-lnk" href="searchform.html"><img src="assets/images/search.png" alt="Search FHIR"/></a>
        </div>


        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">National Directory</span>
            <br/>
            <span style="display:inline-block;">0.1.7 - draft



  <img src="assets/images/usa.svg" alt="United States of America flag" title="United States of America" height="16"/>


            </span>
          </p>
        </div>
      </div>   <!-- /container -->
    </div>    <!-- /segment-header -->

    <div id="segment-navbar" class="segment">    <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">    <!-- container -->
          <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
            <!-- status-bar -->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a href="http://hl7.org/fhir/R4/index.html" class="navbar-brand hidden">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
                <!-- menu.xml -->

<ul class="nav navbar-nav">
  <li>
    <a href="index.html">Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Guidance
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="general-guidance.html">General Guidance</a>
      </li>
      <li>
        <a href="technical-guidance.html">Technical Guidance</a>
      </li>
      <li>
        <a href="bulk-data.html">Bulk Data and Subscriptions</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Definitions
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="profiles.html">Profiles</a>
      </li>
      <li>
        <a href="terminology.html">Terminology</a>
      </li>
      <li>
        <a href="searchparameters.html">Search Parameters</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="usecases.html">Use Cases</a>
  </li>
  <li>
    <a href="downloads.html">Downloads</a>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
</ul>
            </div>    <!-- /.nav-collapse -->
          </div>    <!-- /.container -->
        </nav>    <!-- /.navbar -->
        <!-- /HEADER CONTENT -->
      </div>    <!-- /container -->
    </div>    <!-- /segment-navbar -->
      <!-- status-bar -->

    <div id="segment-breadcrumb" class="segment">    <!-- segment-breadcrumb -->
      <div class="container">    <!-- container -->
        <ul class="breadcrumb">
          <li><a href="toc.html"><b>Table of Contents</b></a></li><li><b>Usecases</b></li>

        </ul>
      </div>    <!-- /container -->
    </div>    <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">    <!-- segment-content -->
      <div class="container">    <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
    <!-- ReleaseHeader --><p id="publish-box">National Directory - Local Development build (v0.1.7). See the <a href="http://hl7.org/fhir/us/fhir-directory-attestation/history.html">Directory of published versions</a></p>  <!-- EndReleaseHeader -->
  <h2>Usecases</h2>
  












    <p>  <!-- white space is critical inside of capture --></p>
<div>
  <!-- do not remove - needed to prevent Jekyll from adding a p tag to any non block level element in the markdown. -->
</div>
<h2 id="cross-track-scenario-notes">Cross-Track Scenario Notes</h2>

<h4 id="directory-look-up">Directory Look Up</h4>

<p><em>Use Case</em></p>
<blockquote>
  <p><a name="l335">​</a><a href="file:///Users/awatson/Code/implementation-guides/fhir-directory-attestation/output/Organization-m6AJtyEk6sSsHWLjt.html">St. James</a> is a hospital network in Connecticut.  They are opening a new infirmary on <a href="file:///Users/awatson/Code/implementation-guides/fhir-directory-attestation/output/Location-l4bjaZGQfeNfhAEpb.html">456 Main Street</a>, and hiring <a href="file:///Users/awatson/Code/implementation-guides/fhir-directory-attestation/output/Practitioner-fZzusFYr3PBYyRnot.html">Dr. Allison Camron</a> to operate it.  As part of setting up their facilities, they first check the directory to see if the facility is already registered, and whether Dr. Camron is licensed by Connecticut yet.</p>
</blockquote>

<p><em>Scenario Workflow</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. Query Practitioner</span>
<span class="c"># Practitioner - Dr. Han Solo</span>
GET <span class="o">{</span>directory<span class="o">}</span>/Practitioner?name<span class="o">=</span>Allison%Camron

<span class="c"># 2. Query Organization</span>
<span class="c"># Organization - St. Jame’s Infirmary</span>
GET <span class="o">{</span>directory<span class="o">}</span>/Organization?name<span class="o">=</span>St.%20Jame%E2%80%99s%20Infirmary

<span class="c"># 3. Query Location</span>
<span class="c"># Location - 456 Main Street, Anytown, CT, 00014</span>
GET <span class="o">{</span>directory<span class="o">}</span>/Location?name<span class="o">=</span>456%20Main%20Street%2C%20Anytown%2C%20CT%2C%2000014

<span class="c"># 4. Query Endpoint</span>
<span class="c"># Endpoint - Acme of Connecticut</span>
GET <span class="o">{</span>directory<span class="o">}</span>/Endpoint?organization<span class="o">=</span>Organization/<span class="o">{</span>organizationId<span class="o">}</span>

<span class="c"># 5. Query HealthcareService</span>
<span class="c"># HealthcareService - Emergency Medical Services</span>
GET <span class="o">{</span>directory<span class="o">}</span>/HealthcareService?category<span class="o">=</span>emerg

<span class="c"># 6. Query CodeSystem</span>
<span class="c"># Code System - NatDir Consent</span>
GET <span class="o">{</span>directory<span class="o">}</span>/CodeSystem/ConsentCS
</code></pre></div></div>

<h4 id="directory-to-directory-subscriptions">Directory to Directory Subscriptions</h4>

<p><em>Use Case</em></p>
<blockquote>
  <p>St. James network also operates the federated directory for the State of Conneticut, meaning they keep a full copy of the national directory on servers at the hospital, along with various Conneticut specific records.  As part of configuring their federated directory, they set up subscriptions to updates and changes that happen on the national directory.  This involves a POST (i.e. push) message from the federated directory to the national directory, which will then POST messages in response at regular intervals or upon specified events.</p>
</blockquote>

<p><em>Scenario Workflow</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Practitioner </span>
POST /Subscription 
PUT  /Subscription/
POST /Practitioner 
GET  /AuditEvent?entity<span class="o">=</span>Practitioner/<span class="o">{</span>practitionerId<span class="o">}</span> 

<span class="c"># Organization</span>
POST /Subscription 
PUT  /Subscription/
POST /Organization 
GET  /AuditEvent?entity<span class="o">=</span>Organization/<span class="o">{</span>organizationId<span class="o">}</span> 

<span class="c"># Location</span>
POST /Subscription 
PUT  /Subscription/
POST /Location 
GET  /AuditEvent?entity<span class="o">=</span>Location/<span class="o">{</span>locationId<span class="o">}</span> 

<span class="c"># Endpoint </span>
POST /Subscription 
PUT  /Subscription/
POST /Endpoint 
GET  /AuditEvent?entity<span class="o">=</span>Endpoint/<span class="o">{</span>endpointId<span class="o">}</span> 

<span class="c"># HealthcareService </span>
POST /Subscription 
PUT  /Subscription/
POST /HealthcareService  
GET  /AuditEvent?entity<span class="o">=</span>HealthcareService/<span class="o">{</span>healthcareServiceId<span class="o">}</span> 
</code></pre></div></div>

<h4 id="dynamic-registration">Dynamic Registration</h4>

<p><em>Use Case</em></p>
<blockquote>
  <p>Administrators at St. James decide that they wish to be able to submit updates to the National Directory, so they begin the process to register an account.  This involves gathering server keys from both the National Directory and their own hospital network, and submiting a signed software statement and registration request to the national directory.  The server will responsd with client IDs that can then be used during authorization and exchanged for an access token.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
GET <span class="o">{</span>nationalDirectory<span class="o">}</span>/.well-known/udap
<span class="c"># result&gt; NationalDirectoryPublicCert</span>

<span class="c"># payload&gt; software_s_tatement(national_d_irectory_p_ublic_cert, app_cert)</span>
POST <span class="o">{</span>nationalDirectory<span class="o">}</span>/oauth/register
<span class="c"># result&gt; client_id</span>

<span class="c"># payload&gt; client_id</span>
POST <span class="o">{</span>nationalDirectory<span class="o">}</span>/oauth/authorize
<span class="c"># access_token (Bearer token)</span>
</code></pre></div></div>

<p>The directory needs authentication/authorization to get to sensitive data.  This use case relies on the simpler <em>client credential</em> code flow, meaning the access is specified on an organizational account or application level.  Instead of logging in individual users, the public directory simply needs to know if you’re a user using a particular piece of software; with the assumption that anybody with access to that software also has access to the directory.</p>

<p>Please refer to <a href="https://www.udap.org/UDAPTestTool/">UDAP ServerTest 20 - Client Credentials Flow</a> for testing guidance.</p>

<h4 id="to-write-directory-data">To Write Directory Data</h4>

<blockquote>
  <p>Seeing that the Infirmary is not present in their local federated copy of the national database, St. James administrators register a new Organization with the federated directory, along with associated Location, HealthcareService, and Endpoint.  Seeing that Dr. Camron record does not reflect her recent licensure in the State of Conneticut either, they patch her Practitioner record also.  After they send the attestion in (via a PATCh command), they re-query the directory to confirm that the update went through.  After the local Federated Directory is updated and returning data as expected, they then send the changes as an attestation to the National Directory using the same API.</p>
</blockquote>

<p><em>Attestation</em></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT /Organization
PATCH /Organization/<span class="o">{</span>organizationId<span class="o">}</span>
GET /Organization/<span class="o">{</span>organizationId<span class="o">}</span>

PUT /Location
PATCH /Location/<span class="o">{</span>locationId<span class="o">}</span>
GET /Location/<span class="o">{</span>locationId<span class="o">}</span>

PUT /HealthcareService
PATCH /HealthcareService/<span class="o">{</span>healthcareServiceId<span class="o">}</span>
GET /HealthcareService/<span class="o">{</span>healthcareServiceId<span class="o">}</span>

PUT /Endpoint
PATCH /Endpoint/<span class="o">{</span>endpointId<span class="o">}</span>
GET /Endpoint/<span class="o">{</span>endpointId<span class="o">}</span>

PUT /Practitioner
PATCH /Practitioner/<span class="o">{</span>practitionerId<span class="o">}</span>
GET /Practitioner/<span class="o">{</span>practitionerId<span class="o">}</span>

</code></pre></div></div>

<blockquote>
  <p>After receiving an attestation from an external source, clerks operating the National Directory reach out to the Conneticut State Licensing Board to verify that Allison Camron is licensed to practice medicine in that state.  Because interoperable systems use the same APIs, the National Directory sends a</p>
</blockquote>

<p><em>Validation</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. State Licensing Board</span>
GET <span class="o">{</span>stateLicensingBoard<span class="o">}</span>/Practitioner?name<span class="o">=</span>Allison%Camron

<span class="c"># 2. Centers for Medicare Services</span>
GET <span class="o">{</span>cms<span class="o">}</span>/Organization?name<span class="o">=</span>St.%20Jame%E2%80%99s%20Infirmary
GET <span class="o">{</span>cms<span class="o">}</span>/HealthcareService?category<span class="o">=</span>emerg

<span class="c"># 3. US Post Office</span>
GET <span class="o">{</span>postOffice<span class="o">}</span>/Location?name<span class="o">=</span>456%20Main%20Street%2C%20Anytown%2C%20CT%2C%2000014
</code></pre></div></div>

<h4 id="tiered-oauth">Tiered oauth</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># add the women's shelter and a restriction for it</span>
PUT <span class="o">{</span>directory<span class="o">}</span>/Organization/<span class="o">{</span>organizationId<span class="o">}</span>
PUT <span class="o">{</span>directory<span class="o">}</span>/PractitionerRole
PUT <span class="o">{</span>directory<span class="o">}</span>/Restriction

<span class="c"># Authentication: None</span>
GET /Organization/<span class="o">{</span>organizationId<span class="o">}</span>  <span class="c"># returns OperationOutcome(false)</span>

<span class="c"># Authentication: Bearer Token (Authenticated User)</span>
GET /Organization/<span class="o">{</span>organizationId<span class="o">}</span> 
</code></pre></div></div>

<h4 id="organization--practitioner-match">Organization &amp; Practitioner Match</h4>

<p>using $match</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># payload:  Organization2</span>
POST <span class="o">{</span>directory<span class="o">}</span>/Organization/<span class="o">{</span>organization1<span class="o">}</span>/<span class="nv">$match</span>

<span class="c"># payload:  Practitioner2</span>
POST <span class="o">{</span>directory<span class="o">}</span>/Practitioner/<span class="o">{</span>practitioner1<span class="o">}</span>/<span class="nv">$match</span>

</code></pre></div></div>




</div>
        </div>    <!-- /inner-wrapper -->
      </div>    <!-- /row -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-content -->

  <script src="assets/js/jquery.js" type="text/javascript"> </script>       <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script src="assets/js/jquery-ui.min.js" type="text/javascript"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div igtool="footer" id="segment-footer" class="segment">    <!-- segment-footer -->
    <div class="container">    <!-- container -->

      <div class="inner-wrapper">
        <p>
          IG &copy; 2021+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.hl7.org/Special/committees/pafm/index.cfm">HL7 Patient Administration Working Group</a>.  Package hl7.fhir.us.fhir-directory-attestation#0.1.7 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Fri, Jul 15, 2022 12:22-0400">2022-07-15</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)"></span>
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
                 | <a style="color: #81BEF7" href="http://hl7.org/fhir/us/fhir-directory-attestation/history.html" target="_blank">Version History</a> |
                 <a rel="license" style="color: #81BEF7" href="http://hl7.org/fhir/R4/license.html"><img src="cc0.png" alt="CC0" style="border-style: none;"/></a> |
                   <!-- <a style="color: #81BEF7" href="todo.html">Search</a> | --> 
                 <a style="color: #81BEF7" href="http://hl7.org/fhir-issues" target="_blank">Propose a change</a>
          
        </p>
      </div>    <!-- /inner-wrapper -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">    <!-- segment-post-footer -->
    <div class="container">    <!-- container -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-post-footer -->
  
    <!-- JS and analytics only. -->
    <!-- Bootstrap core JavaScript
  ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  <script src="assets/js/bootstrap.min.js" type="text/javascript"> </script>
  <script src="assets/js/respond.min.js" type="text/javascript"> </script>
  <script src="assets/js/anchor.min.js" type="text/javascript"> </script>
  <script src="assets/js/clipboard.min.js" type="text/javascript"> </script>
  <script src="assets/js/clipboard-btn.js" type="text/javascript"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
  <!-- feedback form - Google forms -->
  <!-- v0.1, 2021-01-09 -->



  <!-- / feedback form -->

    <!-- Analytics Below
  ================================================== -->
  </body>
</html>